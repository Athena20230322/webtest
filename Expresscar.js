const express = require("express");
const app = express();
app.use(express.json());

app.post("/scan-ticket", (req, res) => {
  const qrData = req.body.qr; // 從掃描器端傳來
  // 假設你解碼出來的格式如下（實際會更複雜，加密或 token）
  const mockValidCode = "340346341355084599309068404851437084147343293212853073489228277306313934461337341166086375277917656308485212274305309069350078273087467580413916981853341292273375329678716334489275211560309901094590269213282887325933667580425023467324261884849065477212272375309068093854277708144340313052337069201244274376309324349845273023467324428804858594273084275376309068332589337023595362429900849065477212272581261324401838273023467324261884849065477212272375309068093845489567595362277917208355457212272375313325076342349711528596261900794577477628147321261020080321261020080321261020080321261020080321261020080360337692080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020080321261020210837261020080321261020080321261020080321261020080321261019832236071705123017944286772492071705123017944286772492071705064000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";

  if (qrData === mockValidCode) {
    // 模擬進行扣款
    return res.json({ success: true, message: "扣款成功：NT$ 20" });
  } else {
    return res.status(400).json({ success: false, message: "無效的乘車碼" });
  }
});

app.listen(3011, () => {
  console.log("伺服器已啟動在 http://localhost:3011");
});
